<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ® Controlador - Good Call Travel</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0a0a0a; color: #fff;
            min-height: 100vh; padding: 16px;
        }
        h1 { text-align: center; font-size: 22px; margin-bottom: 16px; color: #FFC107; }
        .section {
            background: #1a1a1a; border-radius: 12px;
            padding: 16px; margin-bottom: 12px; border: 1px solid #333;
        }
        .section h2 {
            font-size: 14px; color: #aaa; margin-bottom: 12px;
            text-transform: uppercase; letter-spacing: 1px;
        }
        .row { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 10px; }
        button {
            padding: 12px 16px; border: none; border-radius: 8px;
            font-size: 14px; font-weight: 700; cursor: pointer;
            transition: transform 0.1s, opacity 0.1s; flex: 1; min-width: 80px;
        }
        button:active { transform: scale(0.95); opacity: 0.8; }
        .btn-play { background: #4CAF50; color: white; }
        .btn-stop { background: #f44336; color: white; }
        .btn-action { background: #2196F3; color: white; }
        .btn-mute { background: #FF9800; color: white; }
        .btn-seek { background: #9C27B0; color: white; }

        .slider-row {
            display: flex; align-items: center; gap: 10px; margin-top: 8px;
        }
        .slider-row label { font-size: 13px; color: #888; min-width: 55px; }
        .slider-row input[type="range"] {
            flex: 1; height: 6px; -webkit-appearance: none;
            background: #333; border-radius: 3px; outline: none;
        }
        .slider-row input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; width: 20px; height: 20px;
            border-radius: 50%; background: #FFC107; cursor: pointer;
        }
        .slider-row span { font-size: 13px; min-width: 45px; text-align: right; color: #FFC107; }

        #status {
            text-align: center; padding: 8px; font-size: 12px; color: #444; margin-top: 8px;
        }
        #status.ok { color: #4CAF50; }
        #status.err { color: #f44336; }

        .timeline-display {
            text-align: center; font-size: 12px; color: #666; margin-top: 4px;
        }
    </style>
</head>
<body>
    <h1>ğŸ® CONTROL OVERLAY</h1>

    <!-- AUDIO (YouTube oculto) -->
    <div class="section">
        <h2>ğŸµ Audio (YouTube)</h2>
        <div class="row">
            <button class="btn-play" onclick="send('audio','play')">â–¶ Play</button>
            <button class="btn-stop" onclick="send('audio','pause')">â¸ Pause</button>
            <button class="btn-action" onclick="send('audio','restart')">ğŸ” Reiniciar</button>
        </div>
        <div class="row">
            <button class="btn-seek" onclick="send('audio','seek', Math.max(0, audioTime - 15))">âª -15s</button>
            <button class="btn-seek" onclick="send('audio','seek', Math.max(0, audioTime - 5))">âª -5s</button>
            <button class="btn-seek" onclick="send('audio','seek', audioTime + 5)">â© +5s</button>
            <button class="btn-seek" onclick="send('audio','seek', audioTime + 15)">â© +15s</button>
        </div>
        <div class="slider-row">
            <label>Volumen:</label>
            <input type="range" min="0" max="100" value="50" id="audioVol"
                oninput="send('audio','volume',+this.value); document.getElementById('audioVolLabel').textContent=this.value+'%'">
            <span id="audioVolLabel">50%</span>
        </div>
        <div class="slider-row">
            <label>PosiciÃ³n:</label>
            <input type="range" min="0" max="3600" value="0" id="audioSeek"
                oninput="audioTime=+this.value; document.getElementById('audioSeekLabel').textContent=fmtTime(this.value)"
                onchange="send('audio','seek',+this.value)">
            <span id="audioSeekLabel">0:00</span>
        </div>
        <div class="row" style="margin-top:6px;">
            <button class="btn-mute" onclick="send('audio','mute')">ğŸ”‡ Mute</button>
            <button class="btn-play" onclick="send('audio','unmute')">ğŸ”Š Unmute</button>
        </div>
    </div>

    <!-- VIDEO (YouTube visible) -->
    <div class="section">
        <h2>ğŸ“º Video (YouTube)</h2>
        <div class="row">
            <button class="btn-play" onclick="send('video','play')">â–¶ Play</button>
            <button class="btn-stop" onclick="send('video','pause')">â¸ Pause</button>
            <button class="btn-action" onclick="send('video','restart')">ğŸ” Reiniciar</button>
        </div>
        <div class="row">
            <button class="btn-seek" onclick="send('video','seek', Math.max(0, videoTime - 15))">âª -15s</button>
            <button class="btn-seek" onclick="send('video','seek', Math.max(0, videoTime - 5))">âª -5s</button>
            <button class="btn-seek" onclick="send('video','seek', videoTime + 5)">â© +5s</button>
            <button class="btn-seek" onclick="send('video','seek', videoTime + 15)">â© +15s</button>
        </div>
        <div class="slider-row">
            <label>Volumen:</label>
            <input type="range" min="0" max="100" value="30" id="videoVol"
                oninput="send('video','volume',+this.value); document.getElementById('videoVolLabel').textContent=this.value+'%'">
            <span id="videoVolLabel">30%</span>
        </div>
        <div class="slider-row">
            <label>PosiciÃ³n:</label>
            <input type="range" min="0" max="3600" value="0" id="videoSeek"
                oninput="videoTime=+this.value; document.getElementById('videoSeekLabel').textContent=fmtTime(this.value)"
                onchange="send('video','seek',+this.value)">
            <span id="videoSeekLabel">0:00</span>
        </div>
        <div class="row" style="margin-top:6px;">
            <button class="btn-mute" onclick="send('video','mute')">ğŸ”‡ Mute</button>
            <button class="btn-play" onclick="send('video','unmute')">ğŸ”Š Unmute</button>
        </div>
    </div>

    <div id="status">Conectando...</div>

    <script>
    var statusEl = document.getElementById('status');
    var audioTime = 0;
    var videoTime = 0;

    function fmtTime(s) {
        s = Math.round(+s);
        var m = Math.floor(s / 60);
        var sec = s % 60;
        return m + ':' + (sec < 10 ? '0' : '') + sec;
    }

    function send(target, action, value) {
        var body = { target: target, action: action };
        if (value !== undefined) body.value = Math.round(+value);

        // Actualizar tracker local
        if (action === 'seek') {
            if (target === 'audio') audioTime = body.value;
            if (target === 'video') videoTime = body.value;
        }

        fetch('/command', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(body)
        })
        .then(function(r) { return r.json(); })
        .then(function() {
            statusEl.textContent = 'âœ… ' + target + ' â†’ ' + action + (value !== undefined ? ' (' + (action === 'seek' ? fmtTime(value) : value) + ')' : '') + ' â€” ' + new Date().toLocaleTimeString();
            statusEl.className = 'ok';
        })
        .catch(function(err) {
            statusEl.textContent = 'âŒ Error: ' + err.message;
            statusEl.className = 'err';
        });
    }

    // Incrementar tiempo local cada segundo (aproximado)
    setInterval(function() {
        audioTime++;
        videoTime++;
    }, 1000);

    // Check conexiÃ³n
    fetch('/command').then(function() {
        statusEl.textContent = 'âœ… Conectado al servidor';
        statusEl.className = 'ok';
    }).catch(function() {
        statusEl.textContent = 'âŒ No se puede conectar';
        statusEl.className = 'err';
    });
    </script>
</body>
</html>
